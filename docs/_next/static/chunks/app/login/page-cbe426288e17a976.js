(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{1337:(e,t,a)=>{"use strict";a.d(t,{CF:()=>s,KJ:()=>S,TK:()=>d,Yd:()=>p,bx:()=>g,cb:()=>h,hG:()=>c,ht:()=>l,nu:()=>u,wU:()=>r,wx:()=>m});let n="hyundai_users",i="hyundai_dashboard",o=[{id:"1",email:"admin@hyundai-autoever.com",password:"admin123",fullName:"관리자",department:"IT부",role:"admin",status:"active",lastLogin:"2024-08-16T10:30:00Z",createdAt:"2024-01-01T09:00:00Z",otpSecret:"JBSWY3DPEHPK3PXP"},{id:"2",email:"user1@hyundai-autoever.com",password:"user123",fullName:"김철수",department:"보안팀",role:"user",status:"active",lastLogin:"2024-08-16T09:15:00Z",createdAt:"2024-02-15T14:20:00Z",otpSecret:"JBSWY3DPEHPK3PXQ"},{id:"3",email:"user2@hyundai-autoever.com",password:"user123",fullName:"이영희",department:"운영팀",role:"user",status:"active",lastLogin:"2024-08-15T16:45:00Z",createdAt:"2024-03-10T11:30:00Z",otpSecret:"JBSWY3DPEHPK3PXR"},{id:"4",email:"guest@hyundai-autoever.com",password:"guest123",fullName:"박민수",department:"외부업체",role:"guest",status:"pending",lastLogin:"2024-08-14T13:20:00Z",createdAt:"2024-08-14T13:00:00Z"},{id:"5",email:"inactive@hyundai-autoever.com",password:"inactive123",fullName:"정지훈",department:"개발팀",role:"user",status:"inactive",lastLogin:"2024-07-20T10:00:00Z",createdAt:"2024-04-01T09:00:00Z",otpSecret:"JBSWY3DPEHPK3PXS"}];function r(){if(localStorage.getItem(n)||localStorage.setItem(n,JSON.stringify(o)),!localStorage.getItem(i)){let e={totalUsers:o.length,activeUsers:o.filter(e=>"active"===e.status).length,pendingUsers:o.filter(e=>"pending"===e.status).length,totalSessions:142};localStorage.setItem(i,JSON.stringify(e))}}function s(){let e=localStorage.getItem(n);return e?JSON.parse(e):[]}function l(e){return s().find(t=>t.email===e)||null}function u(e){let t=s(),a={...e,id:Date.now().toString(),createdAt:new Date().toISOString()};return t.push(a),localStorage.setItem(n,JSON.stringify(t)),f(),a}function d(e,t){let a=s(),i=a.findIndex(t=>t.id===e);return -1===i?null:(a[i]={...a[i],...t},localStorage.setItem(n,JSON.stringify(a)),f(),a[i])}function c(e){let t=s(),a=t.filter(t=>t.id!==e);return a.length!==t.length&&(localStorage.setItem(n,JSON.stringify(a)),f(),!0)}function g(e){let t=s(),a=t.findIndex(t=>t.email===e);-1!==a&&(t[a].lastLogin=new Date().toISOString(),localStorage.setItem(n,JSON.stringify(t)))}function m(){let e=localStorage.getItem(i);return e?JSON.parse(e):{totalUsers:0,activeUsers:0,pendingUsers:0,totalSessions:0}}function f(){let e=s(),t={totalUsers:e.length,activeUsers:e.filter(e=>"active"===e.status).length,pendingUsers:e.filter(e=>"pending"===e.status).length,totalSessions:m().totalSessions};localStorage.setItem(i,JSON.stringify(t))}function h(e){return({admin:"관리자",user:"일반사용자",guest:"게스트"})[e]}function S(e){return({active:"활성",inactive:"비활성",pending:"대기"})[e]}function p(e){return({active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800"})[e]}},1766:(e,t,a)=>{Promise.resolve().then(a.bind(a,9690))},2056:(e,t,a)=>{"use strict";a.d(t,{$c:()=>i,Gs:()=>r,Kk:()=>s});let n="hyundai_users",i=e=>{let t=o();t.push(e),localStorage.setItem(n,JSON.stringify(t))},o=()=>{let e=localStorage.getItem(n);return e?JSON.parse(e):[]},r=e=>o().find(t=>t.email===e)||null,s=(e,t)=>{let a=o(),i=a.findIndex(t=>t.email===e);-1!==i&&(a[i].otpSecret=t,localStorage.setItem(n,JSON.stringify(a)))}},3333:(e,t,a)=>{"use strict";a.d(t,{Bf:()=>g,EF:()=>u,G4:()=>l,IM:()=>d,JA:()=>s,Rd:()=>r,qk:()=>c,w0:()=>o});let n="hyundai_access_logs",i="hyundai_active_sessions";function o(){if(!localStorage.getItem(n)){let e=function(){let e=new Date,t=[],a=[{id:"1",name:"관리자",email:"admin@hyundai-autoever.com"},{id:"2",name:"김철수",email:"user1@hyundai-autoever.com"},{id:"3",name:"이영희",email:"user2@hyundai-autoever.com"},{id:"4",name:"박민수",email:"guest@hyundai-autoever.com"},{id:"5",name:"정지훈",email:"inactive@hyundai-autoever.com"}],n=["Chrome","Firefox","Safari","Edge"],i=["192.168.1.100","10.0.0.50","172.16.0.25","203.234.112.45"];for(let o=0;o<150;o++){let r=a[Math.floor(Math.random()*a.length)],s=new Date(e.getTime()-30*Math.random()*864e5),l=Math.random()>.1,u=l?Math.floor(7200*Math.random())+300:void 0,d=l&&Math.random()>.2?new Date(s.getTime()+1e3*u):void 0;t.push({id:"log_".concat(Date.now(),"_").concat(o),userId:r.id,userName:r.name,email:r.email,loginTime:s.toISOString(),logoutTime:null==d?void 0:d.toISOString(),ipAddress:i[Math.floor(Math.random()*i.length)],userAgent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",browserInfo:n[Math.floor(Math.random()*n.length)],status:l?d?"logged_out":"active":"failed",sessionDuration:d?u:void 0,loginMethod:l&&Math.random()>.5?"otp":"password",failureReason:l?void 0:["잘못된 비밀번호","존재하지 않는 계정","OTP 오류"][Math.floor(3*Math.random())]})}return t.sort((e,t)=>new Date(t.loginTime).getTime()-new Date(e.loginTime).getTime())}();localStorage.setItem(n,JSON.stringify(e))}}function r(){let e=localStorage.getItem(n);return e?JSON.parse(e):[]}function s(e,t,a){let o=!(arguments.length>3)||void 0===arguments[3]||arguments[3],s=arguments.length>4?arguments[4]:void 0,l={id:"log_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),userId:e,userName:t,email:a,loginTime:new Date().toISOString(),ipAddress:function(){let e=["192.168.1.100","10.0.0.50","172.16.0.25","203.234.112.45","121.156.78.90"];return e[Math.floor(Math.random()*e.length)]}(),userAgent:navigator.userAgent,browserInfo:function(){let e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")&&!e.includes("Chrome")?"Safari":e.includes("Edge")?"Edge":e.includes("Opera")?"Opera":"Unknown"}(),status:o?"active":"failed",loginMethod:o?"otp":"password",failureReason:s},d=r();return d.unshift(l),localStorage.setItem(n,JSON.stringify(d)),o&&function(e){let t=u().filter(t=>t.userId!==e.userId);t.push(e),localStorage.setItem(i,JSON.stringify(t))}(l),l}function l(e){let t=r(),a=t.findIndex(t=>t.userId===e&&"active"===t.status);if(-1!==a){let o=new Date(t[a].loginTime),r=new Date,s=Math.floor((r.getTime()-o.getTime())/1e3);t[a]={...t[a],logoutTime:r.toISOString(),status:"logged_out",sessionDuration:s},localStorage.setItem(n,JSON.stringify(t)),function(e){let t=u().filter(t=>t.userId!==e);localStorage.setItem(i,JSON.stringify(t))}(e)}}function u(){let e=localStorage.getItem(i);return e?JSON.parse(e):[]}function d(e,t){let a=r(),n=new Date(e),i=new Date(t);return i.setHours(23,59,59,999),a.filter(e=>{let t=new Date(e.loginTime);return t>=n&&t<=i})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r(),t=e.length,a=e.filter(e=>"active"===e.status).length,n=e.filter(e=>"failed"===e.status).length,i=e.filter(e=>void 0!==e.sessionDuration);return{totalSessions:t,activeSessions:a,failedAttempts:n,avgSessionDuration:Math.round(i.length>0?i.reduce((e,t)=>e+(t.sessionDuration||0),0)/i.length:0),uniqueUsers:new Set(e.map(e=>e.userId)).size}}function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"access_logs",a=new Blob(["\uFEFF"+function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r(),t=e=>new Date(e).toLocaleString("ko-KR");return["사용자명,이메일,접속일시,로그아웃일시,접속 IP,브라우저,상태,세션 시간(분),로그인 방법,실패 사유",...e.map(e=>{var a;return[e.userName,e.email,t(e.loginTime),e.logoutTime?t(e.logoutTime):"",e.ipAddress,e.browserInfo,"success"===e.status||"active"===e.status||"logged_out"===e.status?"성공":"실패",!(a=e.sessionDuration)?"":Math.round(a/60).toString(),"otp"===e.loginMethod?"OTP":"비밀번호",e.failureReason||""].map(e=>'"'.concat(e,'"')).join(",")})].join("\n")}(e)],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");if(void 0!==n.download){let e=URL.createObjectURL(a);n.setAttribute("href",e),n.setAttribute("download","".concat(t,"_").concat(new Date().toISOString().split("T")[0],".csv")),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}},9400:(e,t,a)=>{"use strict";a.d(t,{Ck:()=>s,KV:()=>l,Kj:()=>r,lz:()=>o});var n=a(8336),i=a(6862);let o=()=>n.authenticator.generateSecret(),r=(e,t)=>n.authenticator.keyuri(e,"현대오토에버",t),s=async e=>{try{return await i.toDataURL(e)}catch(e){throw console.error("QR 코드 생성 실패:",e),e}},l=(e,t)=>{try{return n.authenticator.verify({token:e,secret:t})}catch(e){return console.error("OTP 검증 실패:",e),!1}}},9690:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var n=a(5155),i=a(2115),o=a(5695),r=a(1898),s=a(2056),l=a(9400),u=a(1337),d=a(3333);function c(){let e=(0,o.useRouter)(),[t,a]=(0,i.useState)("credentials"),[c,g]=(0,i.useState)({email:"",password:"",otp:""}),[m,f]=(0,i.useState)(null),[h,S]=(0,i.useState)(""),[p,v]=(0,i.useState)(!1),[w,y]=(0,i.useState)({}),[I,T]=(0,i.useState)(!1);i.useEffect(()=>{(0,d.w0)()},[]);let O=e=>{let{name:t,value:a}=e.target;g(e=>({...e,[t]:a})),w[t]&&y(e=>({...e,[t]:""}))},N=async t=>{if(t.preventDefault(),(()=>{let e={};return c.otp.trim()?/^\d{6}$/.test(c.otp)||(e.otp="OTP는 6자리 숫자여야 합니다."):e.otp="Google OTP를 입력해주세요.",y(e),0===Object.keys(e).length})()){T(!0);try{await new Promise(e=>setTimeout(e,1500)),m&&m.otpSecret&&(0,l.KV)(c.otp,m.otpSecret)?((0,d.JA)(m.email,m.fullName,m.email,!0),sessionStorage.setItem("currentUser",m.email),(0,u.bx)(m.email),e.push("/dashboard")):(m&&(0,d.JA)(m.email,m.fullName,m.email,!1,"OTP 인증 실패"),y({otp:"OTP 코드가 올바르지 않습니다. Google Authenticator에서 생성된 코드를 다시 확인해주세요."}))}catch(e){console.error("2차 인증 실패:",e),y({otp:"인증 중 오류가 발생했습니다."})}finally{T(!1)}}},D=async e=>{if(e.preventDefault(),"credentials"===t){if((()=>{let e={};return c.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)||(e.email="올바른 이메일 형식을 입력해주세요."):e.email="이메일을 입력해주세요.",c.password.trim()||(e.password="비밀번호를 입력해주세요."),y(e),0===Object.keys(e).length})()){T(!0);try{await new Promise(e=>setTimeout(e,1500));let e=(0,s.Gs)(c.email);if(!e){(0,d.JA)("unknown","Unknown User",c.email,!1,"등록되지 않은 이메일"),y({email:"등록되지 않은 이메일입니다."});return}if(e.password!==c.password){(0,d.JA)(e.email,e.fullName,e.email,!1,"잘못된 비밀번호"),y({password:"비밀번호가 올바르지 않습니다."});return}if(!e.otpSecret)return void y({submit:"OTP가 설정되지 않은 계정입니다."});let t=(0,l.Kj)(e.email,e.otpSecret),n=await (0,l.Ck)(t);f(e),S(n),a("otp"),y({})}catch(e){console.error("1차 인증 실패:",e),y({password:"인증 중 오류가 발생했습니다."})}finally{T(!1)}}}else await N(e)};return(0,n.jsx)(r.Yf,{leftSide:(0,n.jsx)(r.lE,{variant:"credentials"===t?"login":"otp",userName:null==m?void 0:m.fullName}),children:"credentials"===t?(0,n.jsx)(r.QB,{formData:c,errors:w,isLoading:I,onInputChange:O,onSubmit:D}):(0,n.jsx)(r.Yl,{formData:c,errors:w,isLoading:I,currentUser:m,qrCodeUrl:h,showQRCode:p,onInputChange:O,onSubmit:D,onToggleQRCode:v,onBack:()=>{a("credentials"),g({email:c.email,password:"",otp:""}),f(null),S(""),v(!1),y({})}})})}}},e=>{e.O(0,[268,874,486,898,441,964,358],()=>e(e.s=1766)),_N_E=e.O()}]);